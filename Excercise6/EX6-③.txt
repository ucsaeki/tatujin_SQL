EX6-③ 関係除算の改良

/*店舗ごとの指定された商品の在庫数と、不足している個数を表示*/

SELECT
	s.shop,
	COUNT(s.item) AS my_item_cnt,
	(
		SELECT
			COUNT(item)
		FROM
			items
	) - COUNT(s.item) AS diff_cnt
FROM
	shop_items AS s
INNER JOIN
	items AS i
ON
	s.item = i.item
GROUP BY
	s.shop
;